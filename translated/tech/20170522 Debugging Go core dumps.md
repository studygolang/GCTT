# Go è¯­è¨€æ ¸å¿ƒæ–‡ä»¶è°ƒè¯•

ç¨‹åºè°ƒå¯¹äºæ£€æŸ¥å’Œç†è§£ç¨‹åºè¿è¡Œè¿‡ç¨‹å’ŒçŠ¶æ€æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚

ä¸€ä¸ªã€æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‘(è¯‘æ³¨ï¼šcore dump file)ä¸­åŒ…å«ç¨‹åºè¿›ç¨‹è¿è¡Œæ—¶çš„å†…å­˜ä¿¡æ¯å’Œè¿›ç¨‹çŠ¶æ€ã€‚å®ƒä¸»è¦ç”¨äºç¨‹åºçš„é—®é¢˜è°ƒè¯•ï¼Œä»¥åŠåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç†è§£ç¨‹åºçš„çŠ¶æ€ã€‚è¿™äº›å¯¹äºæˆ‘ä»¬è¯Šæ–­ç¨‹åºé—®é¢˜åŸå› å’Œåˆ†æç”Ÿäº§ç¯å¢ƒä¸­çš„æœåŠ¡é—®é¢˜æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„hello world ç½‘é¡µåº”ç”¨æœåŠ¡ä¸¾ä¾‹ï¼Œå®é™…æƒ…å†µï¼Œæˆ‘ä»¬çš„ç¨‹åºä¼šæ›´åŠ å¤æ‚ã€‚å¯¹æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶çš„åˆ†ææ„ä¹‰åœ¨äºå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹ç¨‹åºå½“æ—¶çš„è¿è¡Œæƒ…å†µï¼Œå¹¶å¯èƒ½è®©æˆ‘ä»¬æœ‰æœºä¼šé‡ç°å½“æ—¶çš„ç¨‹åºé—®é¢˜ã€‚

**æ³¨æ„**: æ¥ä¸‹æ¥çš„æ“ä½œéƒ½æ˜¯åœ¨Linuxç³»ç»Ÿç»ˆç«¯ä¸­æ‰§è¡Œï¼Œæˆ‘ä¸ç¡®å®šå…¶å®ƒç±»Unixç³»ç»Ÿæ˜¯å¦å¯ä»¥å·¥ä½œæ­£å¸¸ï¼Œmac OS å’Œ Windows åº”è¯¥éƒ½ä¸æ”¯æŒã€‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®å®šå·²ç»æ‰“å¼€äº†æ“ä½œç³»ç»Ÿå¯¹æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶çš„æ”¯æŒã€‚`ulimit` çš„é»˜è®¤å€¼ä¸º0æ„æ€æ˜¯è¯´æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶æœ€å¤§å®¹é‡åªèƒ½æ˜¯é›¶ã€‚æˆ‘é€šå¸¸åœ¨å¼€å‘æœºä¸Šè®¾ç½®ä¸º `unlimited` å‘½ä»¤å¦‚ä¸‹ï¼š

    $ ulimit -c unlimited

ç„¶åï¼Œç¡®å®šä½ çš„æœºå™¨ä¸Šå·²ç»å®‰è£…äº†[delve](https://github.com/derekparker/delve) ã€‚

è¿™æ˜¯ä¸€ä¸ª `main.go` æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ä¸ªHTTPå¯åŠ¨æœåŠ¡å’Œä¸€ä¸ªå¤„ç†å‡½æ•°ã€‚

    $ cat main.go
    package main

    import (
    	"fmt"
    	"log"
    	"net/http"
    )

    func main() {
    	http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
    		fmt.Fprint(w, "hello world\n")
    	})
    	log.Fatal(http.ListenAndServe("localhost:7777", nil))
    }

æˆ‘ä»¬æŠŠå®ƒç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚

    $ go build .

æˆ‘ä»¬å‡è®¾ä¸‹ï¼Œå°†æ¥è¿™ä¸ªæœåŠ¡å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯ä½ ä¸çŸ¥é“ä¼šå‡ºç°ä»€ä¹ˆæ ·çš„é—®é¢˜ã€‚ä½ å¯èƒ½å·²ç»ç”¨äº†å¾ˆå¤šæ–¹æ³•æµ‹è¯•ç¨‹åºä½†ä»ç„¶æ‰¾ä¸åˆ°ç¨‹åºå¼‚å¸¸é€€å‡ºçš„åŸå› ã€‚

åŸºæœ¬ä¸Šï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½èƒ½å¤Ÿæœ‰å½“æ—¶ç¨‹åºè¿›ç¨‹çš„å¿«ç…§ï¼Œç„¶åç”¨ä½ çš„è°ƒè¯•å·¥å…·å¯¹å¿«ç…§è¿›è¡Œè°ƒè¯•ã€‚

æœ‰å¾ˆå¤šç§æ–¹å¼å¯ä»¥è·å¾—ç¨‹åºçš„æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚ä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰ç¨‹åºå´©æºƒè½¬å‚¨æ–¹å¼ï¼Œå½“ç¨‹åºå´©æºƒæ—¶ä¼šå°†å´©æºƒæ—¶çš„ç¨‹åºå†…æ ¸ä¿¡æ¯å†™å…¥ç£ç›˜æ–‡ä»¶ã€‚Go é»˜è®¤æ˜¯ä¸å¼€å¯ç¨‹åºå´©æºƒè½¬å‚¨çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥è®¾ç½® `GOTRACEBACK` ä¸º `crash` æ¥å¼€å¯ Ctrl + backslash ç”Ÿæˆå´©æºƒè½¬å‚¨æ–‡ä»¶ã€‚

    $ GOTRACEBACK=crash ./hello
    (Ctrl+\)

è¿™æ ·å°±å¯ä»¥ä½¿ç¨‹åºå´©æºƒå¹¶å°†å †æ ˆè·Ÿè¸ªæ‰“å°å†™å…¥æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚

å¦ä¸€ç§æ–¹æ³•æ˜¯ä»æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼Œè€Œä¸å¿…æ€æ­»è¿›ç¨‹ã€‚ä½¿ç”¨ `gcore` é€‰é¡¹å°±å¯ä»¥åœ¨ä¸å´©æºƒçš„æƒ…å†µä¸‹ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚æˆ‘ä»¬é‡æ–°å¯åŠ¨ç¨‹åºï¼š

    $ ./hello &
    $ gcore 546 # 546 is the PID of hello.

æˆ‘ä»¬å·²ç»å¯ä»¥åœ¨ç¨‹åºä¸å´©æºƒçš„æƒ…å†µä¸‹æ‹¿åˆ°æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚ä¸‹ä¸€æ­¥é€šè¿‡ delve åŠ è½½å†…æ ¸è½¬å‚¨æ–‡ä»¶è¿›è¡Œåˆ†æã€‚

    $ dlv core ./hello core.546

å¥½äº†ï¼Œå°±æ˜¯è¿™æ ·ã€‚è¿™å’Œ delve çš„æ™®é€šç”¨æ³•æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚ä½ å¯ä»¥å›æ”¾ï¼ŒæŸ¥çœ‹ä»£ç ï¼ŒæŸ¥çœ‹å˜é‡ç­‰ã€‚æœ‰äº›åŠŸèƒ½ä¼šè¢«ç¦ç”¨ï¼Œæ¯•ç«Ÿæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶åªæ˜¯å¿«ç…§ï¼Œè€Œä¸æ˜¯çœŸå®çš„è¿›ç¨‹æƒ…å†µï¼Œä½†æ‰§è¡Œè¿‡ç¨‹å’Œè¿›ç¨‹çŠ¶æ€æ˜¯å®Œå…¨å¯ä»¥è®¿é—®çš„ã€‚

    (dlv) bt
     0  0x0000000000457774 in runtime.raise
        at /usr/lib/go/src/runtime/sys_linux_amd64.s:110
     1  0x000000000043f7fb in runtime.dieFromSignal
        at /usr/lib/go/src/runtime/signal_unix.go:323
     2  0x000000000043f9a1 in runtime.crash
        at /usr/lib/go/src/runtime/signal_unix.go:409
     3  0x000000000043e982 in runtime.sighandler
        at /usr/lib/go/src/runtime/signal_sighandler.go:129
     4  0x000000000043f2d1 in runtime.sigtrampgo
        at /usr/lib/go/src/runtime/signal_unix.go:257
     5  0x00000000004579d3 in runtime.sigtramp
        at /usr/lib/go/src/runtime/sys_linux_amd64.s:262
     6  0x00007ff68afec330 in (nil)
        at :0
     7  0x000000000040f2d6 in runtime.notetsleep
        at /usr/lib/go/src/runtime/lock_futex.go:209
     8  0x0000000000435be5 in runtime.sysmon
        at /usr/lib/go/src/runtime/proc.go:3866
     9  0x000000000042ee2e in runtime.mstart1
        at /usr/lib/go/src/runtime/proc.go:1182
    10  0x000000000042ed04 in runtime.mstart
        at /usr/lib/go/src/runtime/proc.go:1152

    (dlv) ls
    > runtime.raise() /usr/lib/go/src/runtime/sys_linux_amd64.s:110 (PC: 0x457774)
       105:		SYSCALL
       106:		MOVL	AX, DI	// arg 1 tid
       107:		MOVL	sig+0(FP), SI	// arg 2
       108:		MOVL	$200, AX	// syscall - tkill
       109:		SYSCALL
    => 110:		RET
       111:
       112:	TEXT runtimeÂ·raiseproc(SB),NOSPLIT,$0
       113:		MOVL	$39, AX	// syscall - getpid
       114:		SYSCALL
       115:		MOVL	AX, DI	// arg 1 pid

----------------

via: https://rakyll.org/coredumps/

ä½œè€…ï¼š[rakyll](https://rakyll.org/about/)
è¯‘è€…ï¼š[j.zhongming](https://github.com/jzhongming)
æ ¡å¯¹ï¼š[æ ¡å¯¹è€…ID](https://github.com/æ ¡å¯¹è€…ID)

æœ¬æ–‡ç”± [GCTT](https://github.com/studygolang/GCTT) åŸåˆ›ç¼–è¯‘ï¼Œ[Goä¸­æ–‡ç½‘](https://studygolang.com/) è£èª‰æ¨å‡º